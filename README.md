# whtwnd-to-leaflet

A simple browser-based tool for converting WhiteWind blog entries into the Leaflet publication format. It helps migrate content, metadata, and themes from WhiteWind to Leaflet on the AT Protocol.

⚠️ **Experimental** — output is not guaranteed to be fully accurate yet.

---

## How It Works

The app is a single-page web tool (built with **SvelteKit + TypeScript + Tailwind** on Svelte 5) that runs entirely in the browser. No backend is required. It produces a Leaflet-compatible **publication record** plus one or more **document records** from your WhiteWind entries.

The process involves three steps:

1. **Publication Setup**  
   Provide publication details such as name, description, base path, and AT Protocol DID. Configure preferences like enabling comments and whether to appear in the Leaflet Discover feed.

2. **Theme Configuration**  
   Choose colours for the publication’s primary, background, and page background.

3. **Entry Conversion**  
   Paste a JSON export of WhiteWind entries (either an array or an object with `records`/`data`). The converter will:  
   - **Parse Markdown** → transforms into Leaflet blocks (headers, text, blockquotes, code, images, horizontal rules).  
   - **Convert AT-URIs** → changes WhiteWind blob/CID URLs into `at://` URIs where possible.  
   - **Output JSON** → emits one publication record and document records (ZIP export supported).

---

## Usage

**Web app:**

1. Fill out Publication Setup and Theme Configuration.  
2. Paste your WhiteWind JSON entries into the text area. You can fetch them from your PDS with:

```plaintext
https\://\[pds domain]/xrpc/com.atproto.repo.listRecords?repo=\[did]\&collection=com.whtwnd.blog.entry
```

3. Enter your Author DID.  
4. Click **Convert to Leaflet**.  
5. Copy or download the generated JSON files, or use the ZIP export.

### Importing into a PDS

When importing the converted records into a PDS you should follow these rules:

- Use `pdsls.dev` and the ZIP export.
- You’ll need to copy each document record individually; don’t change the autogenerated record key (`rkey`).
- Only change the `rkey` for the one generated by the converter for the publication record itself.

**Local development:**

```bash
npm install
npm run dev
```

Open the URL from Vite (usually `http://localhost:5173`).

**Build & preview:**

```bash
npm run build
npm run preview
```

---

## Files of Interest

* `src/routes/+page.svelte` — main UI and form handling
* `src/lib/convert.ts` — core conversion logic (TID generation, markdown → blocks, URL conversions)
* `src/lib/styles.css`, `src/lib/variables.css` — styles and theme variables
* `src/types/file-saver.d.ts` — small type declaration

---

## Development Notes

* Supports JSON arrays of entries or objects with `records`/`data` arrays.
* Inline rich-text facets (links, bold, italic, code) are extracted when possible and attached to text blocks.

---

## License

Licensed under **GPL 3.0**. See `/LICENSE` for details.

---

**Project:** [ewanc26/whtwnd-to-leaflet](https://github.com/ewanc26/whtwnd-to-leaflet)